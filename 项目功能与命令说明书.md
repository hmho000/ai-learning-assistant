# AI Learning Assistant 项目功能与命令说明书

## 1. 项目整体概述

AI Learning Assistant 是一个面向大学生的智能学习辅助项目，核心功能是**从教材 PDF 自动生成练习题并在线展示**。

**核心工作流程**：
1. **PDF 解析**：从教材 PDF 中提取指定章节的文本内容，自动清洗噪声（页码、页眉页脚等）
2. **AI 出题**：调用 DeepSeek API，基于章节文本自动生成选择题和填空题（包含答案和解析）
3. **Markdown 渲染**：将生成的题目 JSON 渲染为 Markdown 格式，并自动更新前端章节清单（manifest.json）
4. **前端展示**：React 前端从 manifest.json 读取章节列表，动态加载并渲染 Markdown 题库

**项目组成**：
- **后端脚本**（`experiments/` 目录）：Python 脚本实现 PDF 解析、AI 出题、Markdown 渲染
- **一键调度脚本**（`scripts/run_all.py`）：串联上述三个步骤，支持批量处理多个章节
- **前端网页**（`frontend/` 目录）：React + Vite + TailwindCSS，提供题库在线浏览界面
- **数据文件**（`data/` 和 `frontend/public/questions/`）：存储 PDF 教材、生成的题库 JSON/Markdown、章节清单

---

## 2. 目录结构概览（精简版）

```
ai-learning-assistant/
│
├── README.md                          # 项目总体说明文档
│
├── data/                              # 数据目录
│   └── 数据结构（C语言版）...pdf      # 教材 PDF 文件
│
├── experiments/                       # 核心脚本目录
│   ├── parse_pdf_demo.py              # PDF 解析脚本：提取章节文本并清洗
│   ├── generate_questions_demo.py     # AI 出题脚本：调用 DeepSeek API 生成题目 JSON
│   ├── render_questions_demo.py       # Markdown 渲染脚本：JSON → Markdown + 更新 manifest
│   └── output/                        # 脚本输出目录
│       ├── ch1_clean.txt              # 清洗后的章节文本
│       ├── ch1_questions.json        # 生成的题目 JSON
│       ├── ch1_questions.md           # 渲染的 Markdown 题库
│       └── ...
│
├── scripts/                           # 调度脚本目录
│   └── run_all.py                     # 一键调度脚本：串联解析→出题→渲染
│
├── frontend/                          # 前端项目目录
│   ├── package.json                   # 前端依赖配置
│   ├── vite.config.js                 # Vite 构建配置
│   ├── public/
│   │   └── questions/                 # 前端静态资源目录
│   │       ├── manifest.json           # 章节清单（自动更新）
│   │       ├── ch1_questions.md        # Markdown 题库文件（需复制到此处）
│   │       └── ...
│   └── src/
│       ├── main.jsx                    # React 入口文件
│       ├── App.jsx                     # 路由配置
│       ├── pages/
│       │   └── QuestionsPage.jsx       # 题库展示页面（章节选择 + Markdown 渲染）
│       └── components/
│           └── QuestionViewer.jsx      # Markdown 渲染组件
│
└── docs/                              # 文档目录（当前为空）
```

---

## 3. 后端 / 脚本功能说明

### 3.1 parse_pdf_demo.py

**文件路径**：`experiments/parse_pdf_demo.py`

**功能作用**：
- 从教材 PDF 中提取指定章节的文本内容
- 自动识别章节标题（支持“第X章”“第 X 章”“第X章 标题”等多种格式）
- 自动清洗文本：去除页码、页眉页脚、竖排装饰文字，合并断行，压缩多余空行
- 选择最长的章节区段作为正文（避免误抓目录页）

**命令行参数**：
- `--chapter`（**必需**）：目标章节，例如 `"第2章"`、`"第 2 章"`、`"第二章"`、`"第2章 线性表"`
- `--output`（可选，默认 `experiments/output/chapter_2.txt`）：输出文件路径
- `--pdf`（可选）：PDF 文件路径，默认会尝试多个候选路径（`/mnt/data/...`、`data/...`、当前目录 `data/...`）
- `--min-chars`（可选，默认 4000）：输出文本最小字符数
- `--max-chars`（可选，默认 6000）：输出文本最大字符数

**输出格式**：
- 纯文本文件（`.txt`），UTF-8 编码
- 文件命名建议：`ch{章节号}_clean.txt`（例如 `ch1_clean.txt`）

**典型调用示例**：
```powershell
# 提取第1章内容
python .\experiments\parse_pdf_demo.py --chapter "第1章" --output ".\experiments\output\ch1_clean.txt" --pdf ".\data\数据结构（C语言版）（第3版）双色版 (李冬梅,严蔚敏,吴伟民) (Z-Library).pdf"

# 提取第2章，使用默认 PDF 路径
python .\experiments\parse_pdf_demo.py --chapter "第2章 线性表" --output ".\experiments\output\ch2_clean.txt"
```

---

### 3.2 generate_questions_demo.py

**文件路径**：`experiments/generate_questions_demo.py`

**功能作用**：
- 读取清洗后的章节文本（`.txt` 文件）
- 调用 DeepSeek Chat API，基于文本内容自动生成题目
- 生成包含**元数据（meta）**和**题目数组**的 JSON 文件
- 元数据包括：章节编号、章节标题、题库标题、题库描述

**命令行参数**：
- `--input`（可选，默认 `experiments/output/chapter_2.txt`）：章节文本文件路径
- `--output`（可选，默认 `experiments/output/chapter_2_questions.json`）：题目输出 JSON 路径
- `--chapter-id`（可选）：章节编号，例如 `2`（用于提示模型）
- `--chapter-title`（可选）：章节标题，例如 `"第2章 线性表"`（用于提示模型）
- `--model`（可选，默认 `deepseek-chat`）：DeepSeek 模型名称
- `--api-key`（可选）：DeepSeek API Key，也可通过环境变量 `DEEPSEEK_API_KEY` 设置，或使用脚本内默认值
- `--temperature`（可选，默认 0.4）：采样温度（0.4 偏稳重）

**输出格式**：
- JSON 文件，结构如下：
```json
{
  "meta": {
    "chapter_index": 1,
    "chapter_title": "第1章 绪论",
    "quiz_title": "第1章·绪论——算法基础与复杂度分析",
    "quiz_description": "本题库围绕算法的基本特性、评价标准和时间复杂度分析等核心概念设计，适合作为本章学习后的巩固与自测。"
  },
  "multiple_choice": [
    {
      "id": 1,
      "question": "题干……",
      "options": ["A. ……", "B. ……", "C. ……", "D. ……"],
      "answer": "C",
      "explanation": "为什么选 C 的简要说明。"
    }
  ],
  "fill_in_blank": [
    {
      "id": 1,
      "question": "顺序表的逻辑结构是__________。",
      "answer": "线性结构",
      "explanation": "简要说明。"
    }
  ]
}
```

**典型调用示例**：
```powershell
# 从 ch1_clean.txt 生成题目 JSON
python .\experiments\generate_questions_demo.py --input ".\experiments\output\ch1_clean.txt" --output ".\experiments\output\ch1_questions.json" --chapter-id 1 --chapter-title "第1章 绪论"

# 使用自定义 API Key
python .\experiments\generate_questions_demo.py --input ".\experiments\output\ch2_clean.txt" --output ".\experiments\output\ch2_questions.json" --chapter-id 2 --chapter-title "第2章 线性表" --api-key "sk-your-key-here"
```

---

### 3.3 render_questions_demo.py

**文件路径**：`experiments/render_questions_demo.py`

**功能作用**：
- 读取题目 JSON 文件
- 将 JSON 渲染为 Markdown 格式（包含标题、描述、选择题、填空题）
- **自动更新前端 manifest.json**：从 JSON 的 `meta` 字段读取章节信息，添加到章节清单中
- 支持显示/隐藏答案和解析

**命令行参数**：
- `--input`（可选，默认 `experiments/output/chapter_2_questions.json`）：题目 JSON 文件路径
- `--output`（可选，默认打印到 stdout）：输出 Markdown 路径（**必须提供 `--output` 才会更新 manifest.json**）
- `--show-answer`（可选，flag）：输出时显示答案与解析
- `--chapter-id`（可选）：章节 ID，用于 override 或兜底（优先级：命令行参数 > JSON meta > 默认值 1）
- `--chapter-title`（可选）：章节标题，用于 override（优先级：命令行参数 > JSON meta > 默认值）
- `--chapter-desc`（可选）：章节描述，用于 override（优先级：命令行参数 > JSON meta > 空字符串）

**输出格式**：
- Markdown 文件（`.md`），UTF-8 编码
- 包含 H1 标题（来自 `meta.quiz_title`）、描述（来自 `meta.quiz_description`）、选择题和填空题
- 如果使用 `--show-answer`，每题下方会显示正确答案和解析

**manifest.json 更新逻辑**：
- 自动从 JSON 的 `meta` 字段读取：`chapter_index`、`chapter_title`、`quiz_description`
- 如果章节 ID 已存在，则更新；否则新增
- 章节按 ID 排序
- manifest 路径：`frontend/public/questions/manifest.json`

**典型调用示例**：
```powershell
# 渲染 Markdown（不显示答案），并更新 manifest.json
python .\experiments\render_questions_demo.py --input ".\experiments\output\ch1_questions.json" --output ".\experiments\output\ch1_questions.md"

# 渲染 Markdown（显示答案），并更新 manifest.json
python .\experiments\render_questions_demo.py --input ".\experiments\output\ch1_questions.json" --output ".\experiments\output\ch1_questions.md" --show-answer

# 使用命令行参数 override meta 字段
python .\experiments\render_questions_demo.py --input ".\experiments\output\ch2_questions.json" --output ".\experiments\output\ch2_questions.md" --chapter-id 2 --chapter-title "第2章 线性表"
```

---

### 3.4 run_all.py（一键调度脚本）

**文件路径**：`scripts/run_all.py`

**功能作用**：
- **一键串联**三个步骤：PDF 解析 → AI 出题 → Markdown 渲染
- 支持批量处理多个章节（通过 `--chapters` 参数）
- 支持跳过已存在的文件（`--skip-existing`）
- 自动传递章节信息到各个子脚本

**命令行参数**：
- `--pdf`（可选，默认 `data/数据结构（C语言版）...pdf`）：教材 PDF 路径
- `--output-dir`（可选，默认 `./experiments/output`）：输出根目录
- `--chapters`（可选，默认 `1`）：需要处理的章节列表，逗号分隔，例如 `"1,2,3"`
- `--chapter-titles`（可选）：章节标题列表，与 `--chapters` 一一对应，例如 `"绪论,线性表,栈和队列"`
- `--show-answer`（可选，flag）：生成 Markdown 时同时输出答案与解析
- `--skip-existing`（可选，flag）：如果输出文件已存在，则跳过该步骤

**工作流程**：
1. 对每个章节，依次调用：
   - `parse_pdf_demo.py`：生成 `ch{id}_clean.txt`
   - `generate_questions_demo.py`：生成 `ch{id}_questions.json`
   - `render_questions_demo.py`：生成 `ch{id}_questions.md` 并更新 manifest.json
2. 如果使用 `--skip-existing`，已存在的文件会被跳过
3. 所有输出文件保存在 `--output-dir` 指定的目录下

**典型调用示例**：
```powershell
# 处理第1章（使用默认 PDF 和输出目录）
python .\scripts\run_all.py --chapters "1" --chapter-titles "绪论"

# 批量处理第1、2、3章
python .\scripts\run_all.py --chapters "1,2,3" --chapter-titles "绪论,线性表,栈和队列"

# 处理第1章，显示答案，跳过已存在的文件
python .\scripts\run_all.py --chapters "1" --chapter-titles "绪论" --show-answer --skip-existing

# 指定自定义 PDF 路径和输出目录
python .\scripts\run_all.py --pdf ".\data\自定义教材.pdf" --output-dir ".\custom_output" --chapters "1" --chapter-titles "第一章"
```

---

## 4. 前端功能与数据流

### 4.1 入口页面与路由

- **入口文件**：`frontend/src/main.jsx`（React 应用入口）
- **路由配置**：`frontend/src/App.jsx`（使用 React Router）
- **主页面**：`frontend/src/pages/QuestionsPage.jsx`（路由 `/`）

### 4.2 数据加载流程

1. **加载章节清单**：
   - 页面初始化时，从 `/questions/manifest.json` 读取章节列表
   - manifest.json 结构：
     ```json
     {
       "course": "数据结构",
       "chapters": [
         {
           "id": 1,
           "label": "第1章 绪论",
           "shortLabel": "第1章",
           "file": "ch1_questions.md",
           "description": "本题库围绕算法的基本特性..."
         }
       ]
     }
     ```

2. **加载题库 Markdown**：
   - 用户选择章节后，从 `/questions/{chapter.file}` 加载对应的 Markdown 文件
   - 例如：选择第1章时，加载 `/questions/ch1_questions.md`

3. **渲染 Markdown**：
   - 使用 `react-markdown` 库渲染 Markdown 内容
   - 支持 GitHub Flavored Markdown（通过 `remark-gfm` 插件）

### 4.3 主要组件

- **QuestionsPage.jsx**：
  - 章节下拉选择器
  - 加载状态和错误处理
  - 调用 `QuestionViewer` 组件渲染题库

- **QuestionViewer.jsx**：
  - 接收 `markdownText` prop
  - 使用 `ReactMarkdown` 渲染 Markdown
  - 切换章节时自动滚动到顶部

### 4.4 前端构建命令

**开发服务器**：
```powershell
cd frontend
npm run dev
# 或
pnpm dev
```
- 启动 Vite 开发服务器，默认端口 `5173`
- 访问 `http://localhost:5173`

**生产构建**：
```powershell
cd frontend
npm run build
# 或
pnpm build
```
- 构建产物输出到 `frontend/dist/` 目录

**预览构建结果**：
```powershell
cd frontend
npm run preview
# 或
pnpm preview
```
- 预览生产构建结果

---

## 5. 开发者常用命令汇总

### 5.1 后端 / 脚本相关（PowerShell 风格）

#### 单独执行各步骤

**1. 解析某章节 PDF → 生成 clean txt**：
```powershell
python .\experiments\parse_pdf_demo.py --chapter "第1章" --output ".\experiments\output\ch1_clean.txt" --pdf ".\data\数据结构（C语言版）（第3版）双色版 (李冬梅,严蔚敏,吴伟民) (Z-Library).pdf"
```

**2. 从 clean txt 生成 JSON 题库**：
```powershell
python .\experiments\generate_questions_demo.py --input ".\experiments\output\ch1_clean.txt" --output ".\experiments\output\ch1_questions.json" --chapter-id 1 --chapter-title "第1章 绪论"
```

**3. 从 JSON 生成 Markdown 题库**：
```powershell
python .\experiments\render_questions_demo.py --input ".\experiments\output\ch1_questions.json" --output ".\experiments\output\ch1_questions.md"
```

#### 一键执行多个章节

**批量处理第1、2、3章**：
```powershell
python .\scripts\run_all.py --chapters "1,2,3" --chapter-titles "绪论,线性表,栈和队列"
```

**处理单个章节（带答案显示）**：
```powershell
python .\scripts\run_all.py --chapters "1" --chapter-titles "绪论" --show-answer
```

**跳过已存在的文件（增量处理）**：
```powershell
python .\scripts\run_all.py --chapters "1,2,3" --chapter-titles "绪论,线性表,栈和队列" --skip-existing
```

### 5.2 前端相关

**启动本地开发服务器**：
```powershell
cd frontend
npm run dev
```

**打包构建**：
```powershell
cd frontend
npm run build
```

**预览构建结果**：
```powershell
cd frontend
npm run preview
```

### 5.3 端到端示例：从零开始处理“第1章”

**完整流程**：

1. **解析 PDF → 生成 clean txt**：
   ```powershell
   python .\experiments\parse_pdf_demo.py --chapter "第1章" --output ".\experiments\output\ch1_clean.txt" --pdf ".\data\数据结构（C语言版）（第3版）双色版 (李冬梅,严蔚敏,吴伟民) (Z-Library).pdf"
   ```

2. **从 clean txt 生成 JSON 题库**：
   ```powershell
   python .\experiments\generate_questions_demo.py --input ".\experiments\output\ch1_clean.txt" --output ".\experiments\output\ch1_questions.json" --chapter-id 1 --chapter-title "第1章 绪论"
   ```

3. **从 JSON 生成 Markdown 并更新 manifest**：
   ```powershell
   python .\experiments\render_questions_demo.py --input ".\experiments\output\ch1_questions.json" --output ".\experiments\output\ch1_questions.md"
   ```

4. **将 Markdown 复制到前端 public 目录**（**重要：前端需要从这里读取**）：
   ```powershell
   Copy-Item ".\experiments\output\ch1_questions.md" -Destination ".\frontend\public\questions\ch1_questions.md"
   ```

5. **启动前端开发服务器**：
   ```powershell
   cd frontend
   npm run dev
   ```

6. **在浏览器访问** `http://localhost:5173`，选择“第1章”查看题库

**或者使用一键脚本**：
```powershell
# 一键完成步骤 1-3
python .\scripts\run_all.py --chapters "1" --chapter-titles "绪论"

# 然后手动复制 Markdown 到前端目录（步骤 4）
Copy-Item ".\experiments\output\ch1_questions.md" -Destination ".\frontend\public\questions\ch1_questions.md"

# 启动前端（步骤 5）
cd frontend
npm run dev
```

---

## 6. 当前状态 & Todo

### 6.1 实现 vs 文档描述的差异

1. **README.md 描述的功能范围 vs 实际实现**：
   - **文档描述**：支持 PPT、Word、PDF 多种格式；支持简答题、判断题、代码题；支持复习计划、错题本、学习报告
   - **实际实现**：目前仅支持 PDF 解析；仅生成选择题和填空题；无复习计划、错题本、学习报告功能
   - **结论**：**文档超前，代码未跟上**（当前实现为 MVP 版本）

2. **后端架构描述 vs 实际实现**：
   - **文档描述**：Flask / FastAPI 后端、向量数据库、SQLite/MySQL
   - **实际实现**：纯 Python 脚本，无 Web 后端，无数据库
   - **结论**：**文档描述的是未来架构，当前为脚本式实现**

3. **前端数据源**：
   - **当前实现**：前端直接从 `public/questions/` 目录读取 Markdown 文件（静态资源）
   - **注意**：生成的 Markdown 文件需要手动复制到 `frontend/public/questions/` 目录，前端才能访问
   - **建议**：可以在 `render_questions_demo.py` 或 `run_all.py` 中增加自动复制步骤

### 6.2 已知限制与注意事项

1. **API Key 管理**：
   - `generate_questions_demo.py` 中硬编码了默认 API Key（`sk-3242989c595b4e0e9798190133d80bf5`）
   - **建议**：使用环境变量或配置文件管理，避免将 API Key 提交到代码仓库

2. **文件路径依赖**：
   - `parse_pdf_demo.py` 中有硬编码的 PDF 路径候选列表（包括 `/mnt/data/...`，可能是 Linux 环境路径）
   - Windows 环境下建议使用 `--pdf` 参数明确指定路径

3. **前端 Markdown 文件同步**：
   - `render_questions_demo.py` 生成的 Markdown 保存在 `experiments/output/`，但前端从 `frontend/public/questions/` 读取
   - **当前需要手动复制**，建议在脚本中增加自动同步步骤

4. **依赖管理**：
   - 项目中没有 `requirements.txt` 或 `pyproject.toml`
   - **已知依赖**：`PyMuPDF`（fitz）、`requests`
   - **建议**：创建 `requirements.txt` 明确列出所有 Python 依赖

5. **manifest.json 文件命名不一致**：
   - manifest 中第2章的文件名是 `chapter_2_questions.md`，而其他章节是 `ch1_questions.md`、`ch3_questions.md`
   - **建议**：统一命名规范（例如统一使用 `ch{id}_questions.md`）

---

## 附录：快速参考

### 常用命令速查

| 操作 | 命令 |
|------|------|
| 一键处理第1章 | `python .\scripts\run_all.py --chapters "1" --chapter-titles "绪论"` |
| 批量处理多章 | `python .\scripts\run_all.py --chapters "1,2,3" --chapter-titles "绪论,线性表,栈和队列"` |
| 启动前端开发 | `cd frontend && npm run dev` |
| 构建前端 | `cd frontend && npm run build` |
| 复制 Markdown 到前端 | `Copy-Item ".\experiments\output\ch1_questions.md" -Destination ".\frontend\public\questions\ch1_questions.md"` |

### 文件路径速查

| 文件类型 | 默认路径 |
|---------|---------|
| PDF 教材 | `data/数据结构（C语言版）...pdf` |
| 清洗文本 | `experiments/output/ch{id}_clean.txt` |
| 题目 JSON | `experiments/output/ch{id}_questions.json` |
| Markdown 题库 | `experiments/output/ch{id}_questions.md` |
| 前端 manifest | `frontend/public/questions/manifest.json` |
| 前端 Markdown | `frontend/public/questions/ch{id}_questions.md` |

---

**文档版本**：v1.0  
**最后更新**：2024年（基于当前代码库分析）  
**维护者**：项目维护工程师

